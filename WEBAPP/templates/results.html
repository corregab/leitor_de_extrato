<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Resultados - Apura√ß√£o</title>
  <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); min-height:100vh; padding:40px 20px; }
    .container { max-width:1100px; margin:0 auto; }
    .header { background:white; padding:28px; border-radius:20px 20px 0 0; box-shadow:0 20px 60px rgba(0,0,0,.3); }
    .header-content { display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:12px; }
    .header-left { display:flex; align-items:center; gap:14px; }
    .icon { width:52px; height:52px; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:26px; }
    h1 { font-size:26px; font-weight:800; color:#1a202c; letter-spacing:-0.3px; }
    .subtitle { color:#718096; font-size:14px; margin-top:4px; }
    .actions { display:flex; gap:10px; }
    .btn { padding:10px 18px; border:none; border-radius:10px; font-weight:700; cursor:pointer; font-size:14px; transition:.2s; text-decoration:none; display:inline-flex; align-items:center; gap:8px; }
    .btn-primary { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; box-shadow:0 4px 15px rgba(102,126,234,.35); }
    .btn-primary:hover { transform:translateY(-2px); box-shadow:0 6px 20px rgba(102,126,234,.45); }
    .btn-secondary { background:#edf2f7; color:#2d3748; }
    .btn-secondary:hover { background:#e2e8f0; transform:translateY(-2px); }
    .table-container { background:white; padding:24px; border-radius:0 0 20px 20px; box-shadow:0 20px 60px rgba(0,0,0,.3); overflow-x:auto; }
    .search-box { margin-bottom:16px; display:flex; align-items:center; gap:12px; }
    .search-box input { flex:1; padding:12px 16px; border:2px solid #e2e8f0; border-radius:10px; font-size:15px; transition:.2s; }
    .search-box input:focus { outline:none; border-color:#667eea; box-shadow:0 0 0 3px rgba(102,126,234,.15); }
    .search-info { color:#718096; font-size:14px; font-weight:600; white-space:nowrap; }
    table { width:100%; border-collapse:separate; border-spacing:0; min-width:720px; }
    thead { background:#f7fafc; }
    th { padding:14px 12px; text-align:left; font-size:12px; font-weight:800; color:#4a5568; text-transform:uppercase; letter-spacing:.5px; border-bottom:2px solid #e2e8f0; }
    td { padding:14px 12px; border-bottom:1px solid #f0f0f0; color:#2d3748; font-size:14px; }
    tbody tr:hover { background:#f7fafc; }
    .amount { font-weight:700; color:#2f855a; white-space:nowrap; text-align:right; }
    .copy-col { font-family:'Courier New', monospace; color:#718096; font-size:13px; text-align:right; }
    .total-section { background:white; margin-top:20px; padding:22px 24px; border-radius:20px; box-shadow:0 10px 30px rgba(0,0,0,.2); display:flex; justify-content:space-between; align-items:center; }
    .total-label { font-size:16px; color:#4a5568; font-weight:700; }
    .total-value { font-size:30px; font-weight:900; color:#667eea; letter-spacing:-0.3px; }
    .empty-state { text-align:center; padding:60px 20px; color:#718096; }
    .empty-icon { font-size:60px; margin-bottom:14px; opacity:.35; }
    .flash { background:#bee3f8; border-left:4px solid #3182ce; color:#2c5282; padding:12px 16px; border-radius:8px; margin-bottom:16px; font-size:14px; }
    @media (max-width:768px){ .header{padding:22px 18px;} .table-container{padding:18px;} .total-section{flex-direction:column; gap:10px; text-align:center;} h1{font-size:22px;} }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-content">
        <div class="header-left">
          <div class="icon">‚úÖ</div>
          <div>
            <h1>Resultados - {{ bank_label }}</h1>
            <p class="subtitle">{{ rows|length }} cr√©ditos encontrados</p>
          </div>
        </div>
        <div class="actions">
            <button id="copy-values" class="btn btn-primary">Copiar Valores</button>
            <a href="{{ url_for('index') }}" class="btn btn-secondary">Voltar</a>
        </div>
      </div>
    </div>
    <div class="table-container">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, msg in messages %}
            <div class="flash">{{ msg }}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}
      {% if rows %}
        <div class="search-box">
          <input type="text" id="search-input" placeholder="Buscar transa√ß√£o (nome, valor, data, tipo...)">
          <span id="search-info" class="search-info">{{ rows|length }} resultado(s)</span>
        </div>
        <table id="transactions-table">
          <thead>
            <tr>
              <th>Data</th>
              <th>Tipo</th>
              <th>Descri√ß√£o</th>
              <th class="amount">Valor</th>
              <th class="copy-col">Valor (copiar)</th>
            </tr>
          </thead>
          <tbody>
            {% for r in rows %}
              <tr>
                <td>{{ r.date }}</td>
                <td>{{ r.type }}</td>
                <td>{{ r.description }}</td>
                <td class="amount">{{ r.amount }}</td>
                <td class="copy-col">{{ r.amount_plain }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <div class="empty-state">
          <div class="empty-icon">üì≠</div>
          <h3>Nenhum cr√©dito encontrado</h3>
          <p>Tente processar outro extrato</p>
        </div>
      {% endif %}
    </div>
    <div class="total-section">
      <div class="total-label">Total de Cr√©ditos</div>
      <div class="total-value">{{ total }}</div>
    </div>
  </div>
  <script>
    (function(){
      const btn = document.getElementById('copy-values');
      const searchInput = document.getElementById('search-input');
      const table = document.getElementById('transactions-table');
      const rows = table ? Array.from(table.querySelectorAll('tbody tr')) : [];
      if(searchInput && rows.length){
        searchInput.addEventListener('input', function(){
          const q = this.value.toLowerCase().trim();
          let visible = 0;
          rows.forEach(r => {
            const t = r.textContent.toLowerCase();
            if(!q || t.includes(q)) { r.style.display=''; visible++; } else { r.style.display='none'; }
          });
          const info = document.getElementById('search-info');
          if(info) info.textContent = visible + ' resultado(s)';
        });
      }
      if(btn){
        btn.addEventListener('click', async () => {
          const vis = rows.filter(r => r.style.display !== 'none')
                          .map(r => r.querySelector('td.copy-col'))
                          .map(td => (td.textContent||'').trim()).filter(Boolean);
          const text = vis.join('\n');
          try { await navigator.clipboard.writeText(text); } catch(e){
            const ta=document.createElement('textarea'); ta.value=text; document.body.appendChild(ta); ta.select(); try{document.execCommand('copy');}catch(_){} document.body.removeChild(ta);
          }
          btn.textContent='Copiado!'; btn.style.background='#48bb78';
          setTimeout(()=>{ btn.textContent='Copiar Valores'; btn.style.background=''; },1500);
        });
      }
    })();
  </script>
</body>
</html>

